version: "3"

services:
  sermas-ros-proxy:
    image: sermas/ros-proxy
    restart: unless-stopped
    build:
      context: .
    command: ros2 launch ros_proxy launch.py
    environment:
      - SERMAS_TOOLKIT_URL=https://dev.sermas.spindoxlabs.it
      - APP_ID=spxl
      - CLIENT_ID=avatar
      - CLIENT_SECRET=6736d73f7f25ab272b6454cefd471d78d74f338b6e634118
      - LOGLEVEL=INFO

  # landmarks-pipeline:
  #     image: gabry993/mutual-gaze:full
  #     network_mode: host
  #     pid: host
  #     privileged: true
  #     command: ros2 launch users_landmarks_tracking users_landmarks_tracking.launch.xml rectified_image_input:=false debug_node:=true
  #     volumes:
  #       - ./logs:/root/.ros/log:rw
  #       - ./profile.xml:/profile.xml
  #     environment:
  #       - "FASTRTPS_DEFAULT_PROFILES_FILE=/profile.xml"
  
  # interaction-detector:
  #     image: sermas/ros-proxy
  #     network_mode: host
  #     pid: host
  #     privileged: true
  #     command: ros2 launch interaction_intention_detector_ros interaction_intention_detector.launch.xml debug_node:=true

  interaction-manager:
      image: sermas/ros-proxy
      network_mode: host
      pid: host
      privileged: true
      command: ros2 launch interaction_manager interaction_manager.launch.xml debug_node:=true

  bag-player:
    image: gabry993/mutual-gaze:test
    network_mode: host
    pid: host
    privileged: true
    command: ros2 bag play -l test_bag
    volumes:
      - ./logs:/root/.ros/log:rw
      - "/tmp/.X11-unix:/tmp/.X11-unix:rw"
      - ./profile.xml:/profile.xml
    environment:
      - DISPLAY
      - QT_X11_NO_MITSHM=1
      - "FASTRTPS_DEFAULT_PROFILES_FILE=/profile.xml"